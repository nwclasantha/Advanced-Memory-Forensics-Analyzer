/*
    Penetration Testing Tools Detection
    Offensive security tools that may indicate attacks
*/

rule PenTest_Nmap {
    meta:
        description = "Nmap network scanner"
        severity = "medium"
    strings:
        $nmap = "Nmap" ascii nocase
        $nmap2 = "nmap" ascii
        $scan = "scan" ascii nocase
        $port = "port" ascii nocase
        $service = "service" ascii nocase
        $os = "OS" ascii
        $detect = "detect" ascii nocase
    condition:
        (any of ($nmap, $nmap2)) and (2 of ($scan, $port, $service, $os, $detect))
}

rule PenTest_Masscan {
    meta:
        description = "Masscan port scanner"
        severity = "medium"
    strings:
        $masscan = "masscan" ascii nocase
        $fast = "fast" ascii nocase
        $port = "port" ascii nocase
        $scan = "scan" ascii nocase
        $rate = "rate" ascii nocase
    condition:
        $masscan and (2 of ($fast, $port, $scan, $rate))
}

rule PenTest_Nikto {
    meta:
        description = "Nikto web scanner"
        severity = "medium"
    strings:
        $nikto = "Nikto" ascii nocase
        $web = "web" ascii nocase
        $vuln = "vuln" ascii nocase
        $cgi = "CGI" ascii
        $scan = "scan" ascii nocase
    condition:
        $nikto and (any of ($web, $vuln, $cgi, $scan))
}

rule PenTest_Sqlmap {
    meta:
        description = "SQLmap SQL injection tool"
        severity = "high"
    strings:
        $sqlmap = "sqlmap" ascii nocase
        $sqli = "SQL injection" ascii nocase
        $inject = "inject" ascii nocase
        $database = "database" ascii nocase
        $dump = "dump" ascii nocase
        $tamper = "tamper" ascii nocase
    condition:
        $sqlmap or ($sqli and any of ($inject, $database, $dump, $tamper))
}

rule PenTest_Burp_Suite {
    meta:
        description = "Burp Suite proxy"
        severity = "medium"
    strings:
        $burp = "Burp" ascii nocase
        $suite = "Suite" ascii nocase
        $proxy = "proxy" ascii nocase
        $spider = "spider" ascii nocase
        $scanner = "scanner" ascii nocase
        $intruder = "intruder" ascii nocase
    condition:
        ($burp and $suite) or ($proxy and any of ($spider, $scanner, $intruder))
}

rule PenTest_Hydra {
    meta:
        description = "THC-Hydra password cracker"
        severity = "high"
    strings:
        $hydra = "hydra" ascii nocase
        $thc = "THC" ascii
        $crack = "crack" ascii nocase
        $brute = "brute" ascii nocase
        $login = "login" ascii nocase
        $password = "password" ascii nocase
    condition:
        ($hydra or $thc) and (any of ($crack, $brute, $login, $password))
}

rule PenTest_John_The_Ripper {
    meta:
        description = "John the Ripper password cracker"
        severity = "high"
    strings:
        $john = "john" ascii nocase
        $ripper = "ripper" ascii nocase
        $crack = "crack" ascii nocase
        $hash = "hash" ascii nocase
        $wordlist = "wordlist" ascii nocase
        $passwd = "passwd" ascii nocase
    condition:
        ($john and $ripper) or ($crack and any of ($hash, $wordlist, $passwd))
}

rule PenTest_Hashcat {
    meta:
        description = "Hashcat password recovery"
        severity = "high"
    strings:
        $hashcat = "hashcat" ascii nocase
        $hash = "hash" ascii nocase
        $crack = "crack" ascii nocase
        $gpu = "GPU" ascii
        $cuda = "CUDA" ascii
        $opencl = "OpenCL" ascii
    condition:
        $hashcat or ($hash and $crack and any of ($gpu, $cuda, $opencl))
}

rule PenTest_Aircrack_ng {
    meta:
        description = "Aircrack-ng wireless tools"
        severity = "high"
    strings:
        $aircrack = "aircrack" ascii nocase
        $wireless = "wireless" ascii nocase
        $wifi = "WiFi" ascii nocase
        $wpa = "WPA" ascii
        $wep = "WEP" ascii
        $crack = "crack" ascii nocase
    condition:
        $aircrack or (any of ($wireless, $wifi) and any of ($wpa, $wep, $crack))
}

rule PenTest_Responder {
    meta:
        description = "Responder LLMNR/NBT-NS"
        severity = "critical"
    strings:
        $responder = "Responder" ascii nocase
        $llmnr = "LLMNR" ascii
        $nbt = "NBT-NS" ascii
        $ntlm = "NTLM" ascii
        $poison = "poison" ascii nocase
        $relay = "relay" ascii nocase
    condition:
        $responder or ((any of ($llmnr, $nbt)) and (any of ($ntlm, $poison, $relay)))
}

rule PenTest_Impacket {
    meta:
        description = "Impacket network tools"
        severity = "critical"
    strings:
        $impacket = "impacket" ascii nocase
        $smbexec = "smbexec" ascii nocase
        $wmiexec = "wmiexec" ascii nocase
        $psexec = "psexec" ascii nocase
        $secretsdump = "secretsdump" ascii nocase
        $ntlmrelayx = "ntlmrelayx" ascii nocase
    condition:
        $impacket or (2 of ($smbexec, $wmiexec, $psexec, $secretsdump, $ntlmrelayx))
}

rule PenTest_CrackMapExec {
    meta:
        description = "CrackMapExec"
        severity = "critical"
    strings:
        $cme = "CrackMapExec" ascii nocase
        $crackmapexec = "crackmapexec" ascii nocase
        $cme2 = "cme" ascii nocase
        $smb = "SMB" ascii
        $winrm = "WinRM" ascii nocase
        $mssql = "MSSQL" ascii
    condition:
        (any of ($cme, $crackmapexec)) or ($cme2 and any of ($smb, $winrm, $mssql))
}

rule PenTest_BloodHound {
    meta:
        description = "BloodHound AD recon"
        severity = "critical"
    strings:
        $bloodhound = "BloodHound" ascii nocase
        $sharphound = "SharpHound" ascii nocase
        $ad = "ActiveDirectory" ascii nocase
        $ldap = "LDAP" ascii
        $path = "path" ascii nocase
        $admin = "admin" ascii nocase
    condition:
        (any of ($bloodhound, $sharphound)) or ($ad and $ldap and any of ($path, $admin))
}

rule PenTest_PowerUp {
    meta:
        description = "PowerUp privilege escalation"
        severity = "critical"
    strings:
        $powerup = "PowerUp" ascii nocase
        $privesc = "privesc" ascii nocase
        $service = "service" ascii nocase
        $hijack = "hijack" ascii nocase
        $abuse = "abuse" ascii nocase
    condition:
        $powerup or ($privesc and any of ($service, $hijack, $abuse))
}

rule PenTest_BeEF {
    meta:
        description = "Browser Exploitation Framework"
        severity = "critical"
    strings:
        $beef = "BeEF" ascii nocase
        $browser = "browser" ascii nocase
        $exploit = "exploit" ascii nocase
        $hook = "hook" ascii nocase
        $xss = "XSS" ascii
    condition:
        $beef or ($browser and $exploit and any of ($hook, $xss))
}

rule PenTest_SQLNinja {
    meta:
        description = "SQLNinja SQL injection"
        severity = "high"
    strings:
        $sqlninja = "sqlninja" ascii nocase
        $sql = "SQL" ascii
        $injection = "injection" ascii nocase
        $mssql = "MSSQL" ascii
        $takeover = "takeover" ascii nocase
    condition:
        $sqlninja or ($sql and $injection and any of ($mssql, $takeover))
}

rule PenTest_Wpscan {
    meta:
        description = "WPScan WordPress scanner"
        severity = "medium"
    strings:
        $wpscan = "wpscan" ascii nocase
        $wordpress = "WordPress" ascii nocase
        // UNUSED: $wp = "wp-" ascii
        $vuln = "vuln" ascii nocase
        $plugin = "plugin" ascii nocase
        $theme = "theme" ascii nocase
    condition:
        $wpscan or ($wordpress and any of ($vuln, $plugin, $theme))
}

rule PenTest_Enum4linux {
    meta:
        description = "Enum4linux SMB enumeration"
        severity = "high"
    strings:
        $enum4 = "enum4linux" ascii nocase
        $smb = "SMB" ascii
        $enum = "enum" ascii nocase
        $share = "share" ascii nocase
        $user = "user" ascii nocase
        $group = "group" ascii nocase
    condition:
        $enum4 or ($smb and $enum and (2 of ($share, $user, $group)))
}

rule PenTest_Recon_ng {
    meta:
        description = "Recon-ng OSINT framework"
        severity = "medium"
    strings:
        $recon = "recon-ng" ascii nocase
        $osint = "OSINT" ascii
        $framework = "framework" ascii nocase
        $module = "module" ascii nocase
        $domain = "domain" ascii nocase
    condition:
        $recon or ($osint and $framework and any of ($module, $domain))
}

rule PenTest_Dirbuster {
    meta:
        description = "Dirbuster directory scanner"
        severity = "medium"
    strings:
        $dirbuster = "dirbuster" ascii nocase
        $dirb = "dirb" ascii nocase
        $gobuster = "gobuster" ascii nocase
        $directory = "directory" ascii nocase
        $brute = "brute" ascii nocase
        $wordlist = "wordlist" ascii nocase
    condition:
        (any of ($dirbuster, $dirb, $gobuster)) or ($directory and $brute and $wordlist)
}

rule PenTest_Seclists {
    meta:
        description = "SecLists wordlists"
        severity = "low"
    strings:
        $seclists = "SecLists" ascii nocase
        $wordlist = "wordlist" ascii nocase
        $fuzzing = "fuzzing" ascii nocase
        $passwords = "passwords" ascii nocase
        $usernames = "usernames" ascii nocase
    condition:
        $seclists or (2 of ($wordlist, $fuzzing, $passwords, $usernames))
}

