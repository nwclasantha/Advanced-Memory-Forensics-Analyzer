/*
    Advanced Android Malware Detection
    Banking trojans, spyware, ransomware for Android
*/

rule Android_Banking_Cerberus {
    meta:
        description = "Cerberus Android banking trojan"
        severity = "critical"
    strings:
        $cerberus = "cerberus" ascii nocase
        $overlay = "overlay" ascii nocase
        $inject = "inject" ascii nocase
        $accessibility = "AccessibilityService" ascii
        $sms = "SMS" ascii
        // UNUSED: $keylog = "keylog" ascii nocase
    condition:
        (any of ($cerberus, $overlay)) or (($accessibility or $sms) and $inject)
}

rule Android_Banking_Anubis {
    meta:
        description = "Anubis Android banking trojan"
        severity = "critical"
    strings:
        $anubis = "anubis" ascii nocase
        $bankbot = "bankbot" ascii nocase
        $overlay = "overlay" ascii nocase
        $grab = "grab" ascii nocase
        $vnc = "VNC" ascii
        $rat = "RAT" ascii
    condition:
        any of ($anubis, $bankbot) or (($overlay or $grab) and any of ($vnc, $rat))
}

rule Android_Banking_Hydra {
    meta:
        description = "Hydra Android banking trojan"
        severity = "critical"
    strings:
        $hydra = "hydra" ascii nocase
        $exobot = "ExoBot" ascii nocase
        $screen = "screen" ascii nocase
        $record = "record" ascii nocase
        $overlay = "overlay" ascii nocase
        // UNUSED: $accessibility = "AccessibilityService" ascii
    condition:
        any of ($hydra, $exobot) or (($screen or $record) and $overlay)
}

rule Android_Banking_Alien {
    meta:
        description = "Alien Android banking trojan"
        severity = "critical"
    strings:
        $alien = "alien" ascii nocase
        $cerberus = "cerberus" ascii nocase
        $2fa = "2FA" ascii
        $authenticator = "Authenticator" ascii
        // UNUSED: $overlay = "overlay" ascii nocase
    condition:
        any of ($alien, $cerberus) or ($2fa and $authenticator)
}

rule Android_Banking_SharkBot {
    meta:
        description = "SharkBot Android banking trojan"
        severity = "critical"
    strings:
        $sharkbot = "SharkBot" ascii nocase
        $shark = "shark" ascii nocase
        $ats = "ATS" ascii
        $overlay = "overlay" ascii nocase
        $transfer = "transfer" ascii nocase
        // UNUSED: $automatic = "automatic" ascii nocase
    condition:
        any of ($sharkbot, $shark) or ($ats and ($overlay or $transfer))
}

rule Android_Spyware_Pegasus {
    meta:
        description = "NSO Pegasus Android spyware"
        severity = "critical"
    strings:
        $pegasus = "pegasus" ascii nocase
        $nso = "NSO" ascii
        $exploit = "exploit" ascii nocase
        $root = "root" ascii nocase
        $camera = "camera" ascii nocase
        $mic = "microphone" ascii nocase
        $gps = "GPS" ascii
    condition:
        any of ($pegasus, $nso) or (($exploit or $root) and (2 of ($camera, $mic, $gps)))
}

rule Android_Spyware_Predator {
    meta:
        description = "Predator Android spyware"
        severity = "critical"
    strings:
        $predator = "predator" ascii nocase
        $cytrox = "Cytrox" ascii
        $intellexa = "Intellexa" ascii
        $spy = "spy" ascii nocase
        $record = "record" ascii nocase
        $track = "track" ascii nocase
    condition:
        any of ($predator, $cytrox, $intellexa) or ($spy and any of ($record, $track))
}

rule Android_RAT_SpyNote {
    meta:
        description = "SpyNote Android RAT"
        severity = "critical"
    strings:
        $spynote = "SpyNote" ascii nocase
        $cyberrat = "CyberRAT" ascii
        $remote = "remote" ascii nocase
        $camera = "camera" ascii nocase
        $mic = "mic" ascii nocase
        $sms = "SMS" ascii
        $call = "call" ascii nocase
    condition:
        any of ($spynote, $cyberrat) or ($remote and (2 of ($camera, $mic, $sms, $call)))
}

rule Android_RAT_AhMyth {
    meta:
        description = "AhMyth Android RAT"
        severity = "critical"
    strings:
        $ahmyth = "AhMyth" ascii nocase
        $rat = "RAT" ascii
        $control = "control" ascii nocase
        $keylog = "keylog" ascii nocase
        $location = "location" ascii nocase
        $screen = "screenshot" ascii nocase
    condition:
        $ahmyth or ($rat and (2 of ($control, $keylog, $location, $screen)))
}

rule Android_Ransomware_Generic {
    meta:
        description = "Android ransomware"
        severity = "critical"
    strings:
        $ransom = "ransom" ascii nocase
        $encrypt = "encrypt" ascii nocase
        // UNUSED: $decrypt = "decrypt" ascii nocase
        $bitcoin = "bitcoin" ascii nocase
        $lock = "lock" ascii nocase
        $admin = "DeviceAdminReceiver" ascii
        // UNUSED: $screen = "screen" ascii nocase
    condition:
        ($ransom or $encrypt) and ($bitcoin or ($lock and $admin))
}

rule Android_Ransomware_DoubleLocker {
    meta:
        description = "DoubleLocker Android ransomware"
        severity = "critical"
    strings:
        $double = "DoubleLocker" ascii nocase
        $pin = "PIN" ascii
        $change = "change" ascii nocase
        $encrypt = "encrypt" ascii nocase
        // UNUSED: $files = "files" ascii nocase
        $admin = "DeviceAdmin" ascii
    condition:
        $double or (($pin and $change) and ($encrypt or $admin))
}

rule Android_SMS_Stealer {
    meta:
        description = "Android SMS stealer"
        severity = "high"
    strings:
        $sms = "SMS" ascii
        $receive = "SMS_RECEIVED" ascii
        $broadcast = "BroadcastReceiver" ascii
        $content = "content://sms" ascii
        $send = "sendTextMessage" ascii
        $forward = "forward" ascii nocase
    condition:
        ($sms and $receive and $broadcast) or ($content and any of ($send, $forward))
}

rule Android_Overlay_Attack {
    meta:
        description = "Android overlay attack"
        severity = "critical"
    strings:
        $overlay = "TYPE_APPLICATION_OVERLAY" ascii
        $overlay2 = "TYPE_SYSTEM_ALERT" ascii
        $draw = "SYSTEM_ALERT_WINDOW" ascii
        $overlay3 = "overlay" ascii nocase
        $inject = "inject" ascii nocase
        $bank = "bank" ascii nocase
    condition:
        (any of ($overlay, $overlay2, $draw)) and (any of ($inject, $bank, $overlay3))
}

rule Android_Accessibility_Abuse {
    meta:
        description = "Android accessibility service abuse"
        severity = "critical"
    strings:
        $access = "AccessibilityService" ascii
        $event = "AccessibilityEvent" ascii
        $node = "AccessibilityNodeInfo" ascii
        $click = "performAction" ascii
        $input = "ACTION_CLICK" ascii
        // UNUSED: $text = "getText" ascii
    condition:
        ($access or $event) and ($node or $click or $input)
}

rule Android_Keylogger {
    meta:
        description = "Android keylogger"
        severity = "critical"
    strings:
        $keylog = "keylog" ascii nocase
        $input = "InputMethodService" ascii
        $text = "getText" ascii
        $key = "onKey" ascii
        $log = "log" ascii nocase
        $accessibility = "AccessibilityService" ascii
    condition:
        $keylog or ($input and any of ($text, $key, $log)) or ($accessibility and $text)
}

rule Android_Screen_Capture {
    meta:
        description = "Android screen capture"
        severity = "high"
    strings:
        $screen = "screenshot" ascii nocase
        $capture = "MediaProjection" ascii
        $record = "screenrecord" ascii nocase
        $surface = "SurfaceView" ascii
        $bitmap = "Bitmap" ascii
        $vnc = "VNC" ascii
    condition:
        ($screen or $record) and (any of ($capture, $surface, $bitmap, $vnc))
}

rule Android_Location_Tracker {
    meta:
        description = "Android location tracker"
        severity = "high"
    strings:
        $location = "LocationManager" ascii
        $gps = "GPS_PROVIDER" ascii
        $fused = "FusedLocationProviderClient" ascii
        $track = "track" ascii nocase
        $latitude = "getLatitude" ascii
        $longitude = "getLongitude" ascii
    condition:
        ($location or $fused) and ($gps or (any of ($latitude, $longitude, $track)))
}

rule Android_Camera_Spy {
    meta:
        description = "Android camera spy"
        severity = "critical"
    strings:
        $camera = "Camera" ascii
        $camera2 = "camera2" ascii
        $capture = "takePicture" ascii
        $preview = "setPreviewDisplay" ascii
        $hidden = "hidden" ascii nocase
        $spy = "spy" ascii nocase
    condition:
        (any of ($camera, $camera2)) and ($capture or $preview) and (any of ($hidden, $spy))
}

rule Android_Microphone_Spy {
    meta:
        description = "Android microphone spy"
        severity = "critical"
    strings:
        $audio = "AudioRecord" ascii
        $mic = "MediaRecorder" ascii
        $record = "RECORD_AUDIO" ascii
        $source = "AudioSource" ascii
        $voice = "VOICE" ascii
        $spy = "spy" ascii nocase
    condition:
        (any of ($audio, $mic)) and ($record or $source) and (any of ($voice, $spy))
}

rule Android_Contact_Stealer {
    meta:
        description = "Android contact stealer"
        severity = "high"
    strings:
        $contact = "ContactsContract" ascii
        $content = "content://contacts" ascii
        $phone = "PHONE" ascii
        $email = "EMAIL" ascii
        $name = "DISPLAY_NAME" ascii
        $cursor = "Cursor" ascii
    condition:
        (any of ($contact, $content)) and ($cursor and (2 of ($phone, $email, $name)))
}

rule Android_Call_Recorder {
    meta:
        description = "Android call recorder"
        severity = "critical"
    strings:
        $phone = "PHONE_STATE" ascii
        $audio = "AudioRecord" ascii
        $call = "CALL_STATE" ascii
        $voice = "VOICE_CALL" ascii
        $record = "record" ascii nocase
        $incoming = "EXTRA_INCOMING_NUMBER" ascii
    condition:
        ($phone or $call) and ($audio or $voice) and (any of ($record, $incoming))
}

