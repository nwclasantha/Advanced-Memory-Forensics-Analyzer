/*
    Automotive and Vehicle System Malware Detection
    Car hacking, CAN bus attacks, and automotive threats
*/

rule Auto_CAN_Bus_Attack {
    meta:
        description = "CAN bus attack tool"
        severity = "critical"
    strings:
        $can = "CAN" ascii
        $bus = "bus" ascii nocase
        $inject = "inject" ascii nocase
        $frame = "frame" ascii nocase
        $obd = "OBD" ascii
        $socketcan = "SocketCAN" ascii
    condition:
        $can and ($bus or $obd) and any of ($inject, $frame, $socketcan)
}

rule Auto_OBD_Exploit {
    meta:
        description = "OBD-II exploitation"
        severity = "critical"
    strings:
        $obd = "OBD" ascii
        $obd2 = "OBD-II" ascii
        $elm = "ELM327" ascii
        $diagnostic = "diagnostic" ascii nocase
        $exploit = "exploit" ascii nocase
        $hack = "hack" ascii nocase
    condition:
        (any of ($obd, $obd2, $elm)) and any of ($diagnostic, $exploit, $hack)
}

rule Auto_ECU_Firmware {
    meta:
        description = "ECU firmware manipulation"
        severity = "critical"
    strings:
        $ecu = "ECU" ascii
        $firmware = "firmware" ascii nocase
        $flash = "flash" ascii nocase
        $tune = "tune" ascii nocase
        $reprogram = "reprogram" ascii nocase
        $dump = "dump" ascii nocase
    condition:
        $ecu and ($firmware or any of ($flash, $tune, $reprogram, $dump))
}

rule Auto_Keyfob_Attack {
    meta:
        description = "Key fob/keyless entry attack"
        severity = "critical"
    strings:
        $keyfob = "key fob" ascii nocase
        $keyless = "keyless" ascii nocase
        $relay = "relay" ascii nocase
        $amplify = "amplify" ascii nocase
        $clone = "clone" ascii nocase
        $rolling = "rolling code" ascii nocase
    condition:
        (any of ($keyfob, $keyless)) and any of ($relay, $amplify, $clone, $rolling)
}

rule Auto_GPS_Spoof {
    meta:
        description = "GPS spoofing attack"
        severity = "high"
    strings:
        $gps = "GPS" ascii
        $spoof = "spoof" ascii nocase
        $fake = "fake" ascii nocase
        $signal = "signal" ascii nocase
        $location = "location" ascii nocase
        $jamming = "jamming" ascii nocase
    condition:
        $gps and any of ($spoof, $fake, $jamming) and any of ($signal, $location)
}

rule Auto_Telematics_Hack {
    meta:
        description = "Telematics system hack"
        severity = "critical"
    strings:
        $telematics = "telematics" ascii nocase
        $infotainment = "infotainment" ascii nocase
        $uconnect = "Uconnect" ascii nocase
        $sync = "SYNC" ascii
        $carplay = "CarPlay" ascii nocase
        $hack = "hack" ascii nocase
        $exploit = "exploit" ascii nocase
    condition:
        (any of ($telematics, $infotainment, $uconnect, $sync, $carplay)) and any of ($hack, $exploit)
}

rule Auto_CAN_Injection {
    meta:
        description = "CAN message injection"
        severity = "critical"
    strings:
        $can = "CAN" ascii
        $inject = "inject" ascii nocase
        $message = "message" ascii nocase
        $arbitration = "arbitration" ascii nocase
        $id = "ID" ascii
        $frame = "frame" ascii nocase
    condition:
        $can and $inject and any of ($message, $arbitration, $id, $frame)
}

rule Auto_J1939_Attack {
    meta:
        description = "J1939 heavy vehicle protocol attack"
        severity = "critical"
    strings:
        $j1939 = "J1939" ascii
        $heavy = "heavy" ascii nocase
        $truck = "truck" ascii nocase
        $pgn = "PGN" ascii
        $attack = "attack" ascii nocase
    condition:
        $j1939 and any of ($heavy, $truck, $pgn, $attack)
}

rule Auto_UDS_Exploit {
    meta:
        description = "UDS protocol exploitation"
        severity = "critical"
    strings:
        $uds = "UDS" ascii
        $unified = "Unified Diagnostic" ascii nocase
        $service = "service" ascii nocase
        $session = "session" ascii nocase
        $security = "security access" ascii nocase
    condition:
        ($uds or $unified) and any of ($service, $session, $security)
}

rule Auto_Remote_Start {
    meta:
        description = "Remote vehicle start attack"
        severity = "critical"
    strings:
        $remote = "remote" ascii nocase
        $start = "start" ascii nocase
        $engine = "engine" ascii nocase
        $unlock = "unlock" ascii nocase
        $replay = "replay" ascii nocase
    condition:
        $remote and ($start or $unlock) and any of ($engine, $replay)
}

rule Auto_Tire_Pressure_Attack {
    meta:
        description = "TPMS attack"
        severity = "medium"
    strings:
        $tpms = "TPMS" ascii
        $tire = "tire" ascii nocase
        $pressure = "pressure" ascii nocase
        $spoof = "spoof" ascii nocase
        $rf = "RF" ascii
    condition:
        ($tpms or ($tire and $pressure)) and any of ($spoof, $rf)
}

rule Auto_V2X_Attack {
    meta:
        description = "V2X communication attack"
        severity = "critical"
    strings:
        $v2x = "V2X" ascii
        $v2v = "V2V" ascii
        $v2i = "V2I" ascii
        $dsrc = "DSRC" ascii
        $attack = "attack" ascii nocase
        $spoof = "spoof" ascii nocase
    condition:
        (any of ($v2x, $v2v, $v2i, $dsrc)) and any of ($attack, $spoof)
}

rule Auto_Charging_Station {
    meta:
        description = "EV charging station attack"
        severity = "high"
    strings:
        $ev = "EV" ascii
        $charging = "charging" ascii nocase
        $ocpp = "OCPP" ascii
        $station = "station" ascii nocase
        $attack = "attack" ascii nocase
        $exploit = "exploit" ascii nocase
    condition:
        ($ev or $charging or $ocpp) and any of ($station, $attack, $exploit)
}

rule Auto_Immobilizer_Bypass {
    meta:
        description = "Immobilizer bypass"
        severity = "critical"
    strings:
        $immobilizer = "immobilizer" ascii nocase
        $bypass = "bypass" ascii nocase
        $transponder = "transponder" ascii nocase
        $key = "key" ascii nocase
        $clone = "clone" ascii nocase
    condition:
        $immobilizer and any of ($bypass, $transponder, $key, $clone)
}

rule Auto_Speedometer_Tamper {
    meta:
        description = "Speedometer/odometer tampering"
        severity = "high"
    strings:
        $speedometer = "speedometer" ascii nocase
        $odometer = "odometer" ascii nocase
        $mileage = "mileage" ascii nocase
        $tamper = "tamper" ascii nocase
        $rollback = "rollback" ascii nocase
        $modify = "modify" ascii nocase
    condition:
        (any of ($speedometer, $odometer, $mileage)) and any of ($tamper, $rollback, $modify)
}

rule Auto_Bluetooth_OBD {
    meta:
        description = "Bluetooth OBD attack"
        severity = "high"
    strings:
        $bluetooth = "Bluetooth" ascii nocase
        $obd = "OBD" ascii
        $pair = "pair" ascii nocase
        $connect = "connect" ascii nocase
        $exploit = "exploit" ascii nocase
    condition:
        $bluetooth and $obd and any of ($pair, $connect, $exploit)
}

rule Auto_Lidar_Spoof {
    meta:
        description = "LIDAR spoofing attack"
        severity = "critical"
    strings:
        $lidar = "LIDAR" ascii nocase
        $spoof = "spoof" ascii nocase
        $laser = "laser" ascii nocase
        $autonomous = "autonomous" ascii nocase
        $sensor = "sensor" ascii nocase
    condition:
        $lidar and any of ($spoof, $laser) and any of ($autonomous, $sensor)
}

rule Auto_Radar_Jam {
    meta:
        description = "Radar jamming/spoofing"
        severity = "critical"
    strings:
        $radar = "radar" ascii nocase
        $jam = "jam" ascii nocase
        $spoof = "spoof" ascii nocase
        $adaptive = "adaptive cruise" ascii nocase
        $collision = "collision" ascii nocase
    condition:
        $radar and any of ($jam, $spoof) and any of ($adaptive, $collision)
}

rule Auto_Tesla_Hack {
    meta:
        description = "Tesla vehicle attack"
        severity = "critical"
    strings:
        $tesla = "Tesla" ascii nocase
        $model = "Model" ascii nocase
        $autopilot = "Autopilot" ascii nocase
        $hack = "hack" ascii nocase
        $exploit = "exploit" ascii nocase
        $api = "API" ascii
    condition:
        $tesla and any of ($model, $autopilot) and any of ($hack, $exploit, $api)
}

rule Auto_Fleet_Management {
    meta:
        description = "Fleet management system attack"
        severity = "high"
    strings:
        $fleet = "fleet" ascii nocase
        $management = "management" ascii nocase
        $tracking = "tracking" ascii nocase
        $telematics = "telematics" ascii nocase
        $attack = "attack" ascii nocase
        $compromise = "compromise" ascii nocase
    condition:
        ($fleet and $management) and any of ($tracking, $telematics, $attack, $compromise)
}

