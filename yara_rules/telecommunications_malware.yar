/*
   YARA Rules for Telecommunications Sector Malware Detection

   This file contains rules for detecting:
   - Telecom sector targeted threats
   - SIM card attacks
   - SS7 protocol exploitation
   - Mobile network attacks
   - VoIP infrastructure threats

   These rules target threats specific to the telecommunications industry
*/

rule Telecom_SS7_Exploitation
{
    meta:
        description = "Detects SS7 protocol exploitation tools"
        severity = "critical"
        category = "telecom_attack"
        author = "MalwareAnalyzer"
        date = "2024-01-01"

    strings:
        $ss7_1 = "SS7" ascii wide
        $ss7_2 = "Signaling System 7" ascii wide nocase
        $ss7_3 = "MAP protocol" ascii wide nocase
        $ss7_4 = "SIGTRAN" ascii wide
        $cmd1 = "SendRoutingInfo" ascii
        $cmd2 = "ProvideSubscriberLocation" ascii
        $cmd3 = "InsertSubscriberData" ascii
        $attack1 = "intercept" ascii nocase
        $attack2 = "track" ascii nocase
        $imsi = "IMSI" ascii wide

    condition:
        (2 of ($ss7_*) and 1 of ($cmd*)) or
        (1 of ($ss7_*) and $imsi and 1 of ($attack*))
}

rule Telecom_SIM_Swapping_Tool
{
    meta:
        description = "Detects SIM swapping attack tools"
        severity = "critical"
        category = "telecom_fraud"
        author = "MalwareAnalyzer"

    strings:
        $sim1 = "SIM swap" ascii wide nocase
        $sim2 = "SIM card" ascii wide nocase
        $sim3 = "ICCID" ascii wide
        $sim4 = "IMSI" ascii wide
        $carrier1 = "Verizon" ascii wide nocase
        $carrier2 = "AT&T" ascii wide nocase
        $carrier3 = "T-Mobile" ascii wide nocase
        $port1 = "port out" ascii nocase
        $port2 = "number port" ascii nocase
        // UNUSED: $social = "social engineer" ascii nocase

    condition:
        (2 of ($sim*) and 1 of ($carrier*)) or
        (1 of ($sim*) and 1 of ($port*))
}

rule Telecom_IMSI_Catcher
{
    meta:
        description = "Detects IMSI catcher/Stingray type malware"
        severity = "critical"
        category = "telecom_surveillance"
        author = "MalwareAnalyzer"

    strings:
        $imsi1 = "IMSI catcher" ascii wide nocase
        $imsi2 = "Stingray" ascii wide nocase
        $imsi3 = "fake base station" ascii wide nocase
        $imsi4 = "cell tower simulator" ascii wide nocase
        $func1 = "downgrade" ascii nocase
        $func2 = "2G" ascii wide
        $func3 = "GSM" ascii wide
        $intercept1 = "intercept" ascii nocase
        $intercept2 = "eavesdrop" ascii nocase
        $sdr = "SDR" ascii wide

    condition:
        (1 of ($imsi*) and 1 of ($func*)) or
        (1 of ($imsi*) and 1 of ($intercept*) and $sdr)
}

rule Telecom_VoIP_Infrastructure_Attack
{
    meta:
        description = "Detects attacks on VoIP infrastructure"
        severity = "high"
        category = "telecom_attack"
        author = "MalwareAnalyzer"

    strings:
        $voip1 = "VoIP" ascii wide nocase
        $voip2 = "SIP" ascii wide
        $voip3 = "Asterisk" ascii wide
        $voip4 = "FreePBX" ascii wide
        $voip5 = "RTP" ascii wide
        $attack1 = "toll fraud" ascii nocase
        $attack2 = "vishing" ascii nocase
        $attack3 = "SRTP" ascii
        $exploit1 = "buffer overflow" ascii nocase
        $exploit2 = "register flood" ascii nocase

    condition:
        (2 of ($voip*) and 1 of ($attack*)) or
        (1 of ($voip*) and 1 of ($exploit*))
}

rule Telecom_CDR_Data_Theft
{
    meta:
        description = "Detects Call Detail Record theft malware"
        severity = "critical"
        category = "telecom_espionage"
        author = "MalwareAnalyzer"

    strings:
        $cdr1 = "CDR" ascii wide
        $cdr2 = "Call Detail Record" ascii wide nocase
        $cdr3 = "call log" ascii wide nocase
        $cdr4 = "billing record" ascii wide nocase
        $data1 = "caller ID" ascii nocase
        $data2 = "called number" ascii nocase
        $data3 = "duration" ascii nocase
        $data4 = "timestamp" ascii nocase
        $exfil = "export" ascii nocase
        $db = "database" ascii nocase

    condition:
        (2 of ($cdr*) and 2 of ($data*)) or
        (1 of ($cdr*) and $exfil and $db)
}

rule Telecom_5G_Network_Attack
{
    meta:
        description = "Detects attacks targeting 5G networks"
        severity = "critical"
        category = "telecom_5g"
        author = "MalwareAnalyzer"

    strings:
        $5g1 = "5G" ascii wide
        $5g2 = "NR" ascii wide
        $5g3 = "gNodeB" ascii wide
        $5g4 = "5GC" ascii wide
        $proto1 = "NGAP" ascii
        $proto2 = "NAS" ascii wide
        $proto3 = "PFCP" ascii
        $attack1 = "downgrade" ascii nocase
        $attack2 = "spoof" ascii nocase
        $attack3 = "mitm" ascii nocase

    condition:
        (2 of ($5g*) and 1 of ($proto*)) or
        (1 of ($5g*) and 1 of ($attack*) and 1 of ($proto*))
}

rule Telecom_Network_Function_Virtualization
{
    meta:
        description = "Detects attacks on NFV/SDN infrastructure"
        severity = "critical"
        category = "telecom_infrastructure"
        author = "MalwareAnalyzer"

    strings:
        $nfv1 = "NFV" ascii wide
        $nfv2 = "SDN" ascii wide
        $nfv3 = "OpenFlow" ascii wide
        $nfv4 = "VNF" ascii wide
        $platform1 = "OpenStack" ascii wide
        $platform2 = "Kubernetes" ascii wide
        $attack1 = "container escape" ascii nocase
        $attack2 = "privilege escalation" ascii nocase
        $attack3 = "lateral movement" ascii nocase

    condition:
        (2 of ($nfv*) and 1 of ($attack*)) or
        (1 of ($platform*) and 1 of ($nfv*) and 1 of ($attack*))
}

rule Telecom_Baseband_Exploit
{
    meta:
        description = "Detects mobile baseband processor exploits"
        severity = "critical"
        category = "telecom_exploit"
        author = "MalwareAnalyzer"

    strings:
        $baseband1 = "baseband" ascii wide nocase
        $baseband2 = "modem" ascii wide nocase
        $baseband3 = "Qualcomm" ascii wide
        $baseband4 = "Shannon" ascii wide
        $baseband5 = "Intel XMM" ascii wide
        $exploit1 = "RCE" ascii wide
        $exploit2 = "overflow" ascii nocase
        $exploit3 = "OTA" ascii wide
        $rce = "remote code" ascii nocase

    condition:
        (2 of ($baseband*) and 1 of ($exploit*)) or
        (1 of ($baseband*) and $rce)
}

rule Telecom_Carrier_Billing_Fraud
{
    meta:
        description = "Detects carrier billing fraud malware"
        severity = "high"
        category = "telecom_fraud"
        author = "MalwareAnalyzer"

    strings:
        $billing1 = "carrier billing" ascii wide nocase
        $billing2 = "DCB" ascii wide
        $billing3 = "premium SMS" ascii wide nocase
        $billing4 = "WAP billing" ascii wide nocase
        $fraud1 = "subscribe" ascii nocase
        $fraud2 = "premium" ascii nocase
        $fraud3 = "shortcode" ascii nocase
        $sms1 = "sendTextMessage" ascii
        $sms2 = "SmsManager" ascii
        $hide = "hide" ascii nocase

    condition:
        (2 of ($billing*) and 1 of ($fraud*)) or
        (1 of ($billing*) and 1 of ($sms*) and $hide)
}

rule Telecom_OSS_BSS_Attack
{
    meta:
        description = "Detects attacks on OSS/BSS systems"
        severity = "critical"
        category = "telecom_infrastructure"
        author = "MalwareAnalyzer"

    strings:
        $oss1 = "OSS" ascii wide
        $oss2 = "BSS" ascii wide
        $oss3 = "operations support" ascii wide nocase
        $oss4 = "business support" ascii wide nocase
        $sys1 = "NetCracker" ascii wide
        $sys2 = "Amdocs" ascii wide
        $sys3 = "Ericsson" ascii wide
        $attack1 = "SQL injection" ascii nocase
        $attack2 = "credential" ascii nocase
        $data = "subscriber" ascii nocase

    condition:
        (2 of ($oss*) and 1 of ($attack*)) or
        (1 of ($sys*) and 1 of ($oss*) and $data)
}

rule Telecom_SMS_Interception
{
    meta:
        description = "Detects SMS interception malware"
        severity = "critical"
        category = "telecom_surveillance"
        author = "MalwareAnalyzer"

    strings:
        $sms1 = "SMS" ascii wide
        $sms2 = "text message" ascii wide nocase
        $sms3 = "OTP" ascii wide
        $sms4 = "2FA" ascii wide
        $intercept1 = "intercept" ascii nocase
        $intercept2 = "read SMS" ascii nocase
        $intercept3 = "forward" ascii nocase
        $perm1 = "RECEIVE_SMS" ascii
        $perm2 = "READ_SMS" ascii
        $hide = "suppress" ascii nocase

    condition:
        (2 of ($sms*) and 1 of ($intercept*)) or
        (1 of ($perm*) and 1 of ($intercept*) and $hide)
}

rule Telecom_LTE_Protocol_Attack
{
    meta:
        description = "Detects LTE protocol exploitation"
        severity = "critical"
        category = "telecom_exploit"
        author = "MalwareAnalyzer"

    strings:
        $lte1 = "LTE" ascii wide
        $lte2 = "4G" ascii wide
        $lte3 = "eNodeB" ascii wide
        $lte4 = "EPC" ascii wide
        $proto1 = "NAS" ascii wide
        $proto2 = "RRC" ascii wide
        $proto3 = "S1AP" ascii
        $attack1 = "aLTEr" ascii
        $attack2 = "ReVoLTE" ascii
        $attack3 = "IMP4GT" ascii

    condition:
        (2 of ($lte*) and 1 of ($proto*) and 1 of ($attack*)) or
        (1 of ($attack*) and 1 of ($lte*))
}

rule Telecom_eSIM_Attack
{
    meta:
        description = "Detects eSIM attack tools"
        severity = "high"
        category = "telecom_attack"
        author = "MalwareAnalyzer"

    strings:
        $esim1 = "eSIM" ascii wide nocase
        $esim2 = "eUICC" ascii wide
        $esim3 = "embedded SIM" ascii wide nocase
        $esim4 = "SM-DP+" ascii
        $func1 = "profile download" ascii nocase
        $func2 = "remote provisioning" ascii nocase
        $func3 = "profile switch" ascii nocase
        $attack1 = "clone" ascii nocase
        $attack2 = "hijack" ascii nocase

    condition:
        (2 of ($esim*) and 1 of ($func*)) or
        (1 of ($esim*) and 1 of ($attack*))
}

rule Telecom_Diameter_Protocol_Attack
{
    meta:
        description = "Detects Diameter protocol attacks"
        severity = "critical"
        category = "telecom_protocol"
        author = "MalwareAnalyzer"

    strings:
        $diam1 = "Diameter" ascii wide
        $diam2 = "3GPP" ascii wide
        $diam3 = "S6a" ascii
        $diam4 = "Gx" ascii
        $diam5 = "Gy" ascii
        $cmd1 = "Update-Location" ascii
        $cmd2 = "Authentication-Information" ascii
        $cmd3 = "Cancel-Location" ascii
        $attack = "spoof" ascii nocase

    condition:
        (2 of ($diam*) and 1 of ($cmd*)) or
        (1 of ($diam*) and $attack)
}

rule Telecom_GTP_Exploitation
{
    meta:
        description = "Detects GTP protocol exploitation"
        severity = "critical"
        category = "telecom_protocol"
        author = "MalwareAnalyzer"

    strings:
        $gtp1 = "GTP" ascii wide
        $gtp2 = "GPRS Tunneling" ascii wide nocase
        $gtp3 = "GTP-C" ascii
        $gtp4 = "GTP-U" ascii
        $node1 = "GGSN" ascii wide
        $node2 = "SGSN" ascii wide
        $node3 = "PGW" ascii wide
        $attack1 = "tunnel" ascii nocase
        $attack2 = "inject" ascii nocase

    condition:
        (2 of ($gtp*) and 1 of ($node*)) or
        (1 of ($gtp*) and 1 of ($attack*))
}

rule Telecom_Roaming_Fraud
{
    meta:
        description = "Detects roaming fraud malware"
        severity = "high"
        category = "telecom_fraud"
        author = "MalwareAnalyzer"

    strings:
        $roam1 = "roaming" ascii wide nocase
        $roam2 = "VPMN" ascii wide
        $roam3 = "HPMN" ascii wide
        $roam4 = "TAP" ascii wide
        $fraud1 = "fraud" ascii nocase
        $fraud2 = "bypass" ascii nocase
        $fraud3 = "fake" ascii nocase
        $usage = "call record" ascii nocase
        $bill = "billing" ascii nocase

    condition:
        (2 of ($roam*) and 1 of ($fraud*)) or
        (1 of ($roam*) and $usage and $bill)
}

rule Telecom_Core_Network_Backdoor
{
    meta:
        description = "Detects backdoors in telecom core networks"
        severity = "critical"
        category = "telecom_apt"
        author = "MalwareAnalyzer"

    strings:
        $core1 = "core network" ascii wide nocase
        $core2 = "EPC" ascii wide
        $core3 = "IMS" ascii wide
        $core4 = "HSS" ascii wide
        $vendor1 = "Huawei" ascii wide
        $vendor2 = "Nokia" ascii wide
        $vendor3 = "Ericsson" ascii wide
        $backdoor1 = "backdoor" ascii nocase
        $backdoor2 = "implant" ascii nocase
        $backdoor3 = "persistence" ascii nocase

    condition:
        (2 of ($core*) and 1 of ($backdoor*)) or
        (1 of ($vendor*) and 1 of ($core*) and 1 of ($backdoor*))
}

rule Telecom_Subscriber_Database_Theft
{
    meta:
        description = "Detects subscriber database theft"
        severity = "critical"
        category = "telecom_data"
        author = "MalwareAnalyzer"

    strings:
        $db1 = "HLR" ascii wide
        $db2 = "HSS" ascii wide
        $db3 = "subscriber database" ascii wide nocase
        $db4 = "customer database" ascii wide nocase
        $data1 = "MSISDN" ascii wide
        $data2 = "IMEI" ascii wide
        $data3 = "Ki" ascii wide
        $data4 = "authentication vector" ascii nocase
        $exfil = "dump" ascii nocase

    condition:
        (2 of ($db*) and 2 of ($data*)) or
        (1 of ($db*) and $exfil and 1 of ($data*))
}

rule Telecom_Mobile_Switching_Attack
{
    meta:
        description = "Detects attacks on mobile switching centers"
        severity = "critical"
        category = "telecom_infrastructure"
        author = "MalwareAnalyzer"

    strings:
        $msc1 = "MSC" ascii wide
        $msc2 = "Mobile Switching Center" ascii wide nocase
        $msc3 = "VLR" ascii wide
        $msc4 = "switch" ascii wide nocase
        $func1 = "handover" ascii nocase
        $func2 = "paging" ascii nocase
        $func3 = "location update" ascii nocase
        $attack1 = "intercept" ascii nocase
        $attack2 = "redirect" ascii nocase

    condition:
        (2 of ($msc*) and 1 of ($func*) and 1 of ($attack*)) or
        (1 of ($msc*) and 2 of ($attack*))
}

rule Telecom_APT_Carrier_Network
{
    meta:
        description = "Detects APT activity targeting carrier networks"
        severity = "critical"
        category = "telecom_apt"
        author = "MalwareAnalyzer"

    strings:
        $apt1 = "LightBasin" ascii wide
        $apt2 = "Operation Soft Cell" ascii wide
        $apt3 = "MESSAGETAP" ascii wide
        $target1 = "carrier" ascii wide nocase
        $target2 = "telco" ascii wide nocase
        $target3 = "telecom" ascii wide nocase
        $persist1 = "implant" ascii nocase
        $persist2 = "beacon" ascii nocase
        $persist3 = "backdoor" ascii nocase

    condition:
        (1 of ($apt*)) or
        (2 of ($target*) and 1 of ($persist*))
}
